[34m[1mLogs will be synced with wandb.
Config(env_type='MooreMultiTask', n_contexts=1, obs_dim=39, action_dim=4, hidden_dim=256, n_experts=4, moore_temperature=1.0, use_softmax=True, use_checkpoint=True, use_mixed_precision=True, gamma=0.99, stddev=0.1, actor_updates=1, use_ema=True, ensemble_size=5, update_freq=2, seed=42, device=device(type='cuda', index=0), task='mw-reach', obs='state', multitask=False, steps=10000, batch_size=256, reward_coef=0.1, value_coef=0.1, consistency_coef=20, rho=0.5, lr=0.0003, enc_lr_scale=0.3, grad_clip_norm=20, tau=0.01, discount_denom=5, discount_min=0.95, discount_max=0.995, buffer_size=100000, exp_name='moore-tdmpc2-mt30', eval_freq=50000, eval_episodes=10, moore={'n_experts': 4, 'temperature': 1.0, 'use_softmax': True, 'debug_task_emb': False}, mpc=True, iterations=6, num_samples=512, num_elites=64, num_pi_trajs=24, horizon=3, min_std=0.05, max_std=2, temperature=0.5, log_std_min=-10, log_std_max=2, entropy_coef=0.0001, model_size=5, num_enc_layers=2, enc_dim=256, num_channels=32, mlp_dim=512, latent_dim=512, task_dim=0, num_q=5, dropout=0.01, simnorm_dim=8, num_bins=101, vmin=-10, vmax=10, wandb_project='moore-tdmpc2', wandb_entity='OA-MBRL', wandb_silent=False, enable_wandb=True, save_csv=True, save_video=False, save_agent=True, compile=False, work_dir=PosixPath('/home/levi/Documents/MOORE-TDMPC/moore_tdmpc/logs/mw-reach/42/moore-tdmpc2-mt30'), task_title='Mw Reach', tasks=['mw-reach'], obs_shape={'state': (39,)}, episode_length=100, obs_shapes='???', episode_lengths='???', seed_steps=1000, bin_size=0.2, data_dir='/media/levi/Singe4linux/Moore-TDMPC/TDMPC2/data/mt30')
Architecture: TD-MPC2 Moore World Model
Task Encoder: MooreTaskEncoder(obs_dim=39, latent_dim=512, hidden_dim=256, n_experts=4, temperature=1.0, use_softmax=True)
Dynamics: MoEDynamicsModel(latent_dim=512, action_dim=4, hidden_dim=256, n_experts=4, temperature=0.5, use_softmax=True, use_mixed_precision=True)
Reward: MoERewardModel(latent_dim=512, action_dim=4, hidden_dim=256, n_experts=4, temperature=0.5, use_softmax=True, reward_dim=101, top_k=1)
Policy prior: Sequential(
  (0): Linear(in_features=512, out_features=256, bias=True)
  (1): ReLU()
  (2): Linear(in_features=256, out_features=256, bias=True)
  (3): ReLU()
  (4): Linear(in_features=256, out_features=8, bias=True)
)
Q-functions: Ensemble(n_models=5)
Learnable parameters: 5,217,221
[32m[1mÂºÄÂßãMoore-TDMPC2ËÆ≠ÁªÉ...
[36mPROFILER STATUS: Enabled=True, Functions=3, Total Calls=7
[32mOnlineTrainer: Starting training loop with profiling enabled
[36mPROFILER STATUS: Enabled=True, Functions=3, Total Calls=7
[36mPROFILER: forward executed in 1.08ms (call 3)
 [32meval[39m    [34mE:[39m 0            [34mI:[39m 0            [34mR:[39m 242.1        [34mS:[39m 0.0          [34mT:[39m 0:00:01
 [34mtrain[39m   [34mE:[39m 0            [34mI:[39m 100          [34mR:[39m 364.9        [34mS:[39m 0.0          [34mT:[39m 0:00:01
Buffer capacity: 10,000
Storage required: 0.00 GB
Using CUDA:0 memory for storage.
 [34mtrain[39m   [34mE:[39m 1            [34mI:[39m 200          [34mR:[39m 315.7        [34mS:[39m 0.0          [34mT:[39m 0:00:01
 [34mtrain[39m   [34mE:[39m 2            [34mI:[39m 300          [34mR:[39m 605.1        [34mS:[39m 0.0          [34mT:[39m 0:00:01
 [34mtrain[39m   [34mE:[39m 3            [34mI:[39m 400          [34mR:[39m 347.1        [34mS:[39m 0.0          [34mT:[39m 0:00:01
 [34mtrain[39m   [34mE:[39m 4            [34mI:[39m 500          [34mR:[39m 319.2        [34mS:[39m 0.0          [34mT:[39m 0:00:01
 [34mtrain[39m   [34mE:[39m 5            [34mI:[39m 600          [34mR:[39m 274.8        [34mS:[39m 0.0          [34mT:[39m 0:00:01
 [34mtrain[39m   [34mE:[39m 6            [34mI:[39m 700          [34mR:[39m 276.7        [34mS:[39m 0.0          [34mT:[39m 0:00:01
 [34mtrain[39m   [34mE:[39m 7            [34mI:[39m 800          [34mR:[39m 190.2        [34mS:[39m 0.0          [34mT:[39m 0:00:01
 [34mtrain[39m   [34mE:[39m 8            [34mI:[39m 900          [34mR:[39m 547.0        [34mS:[39m 0.0          [34mT:[39m 0:00:01
 [34mtrain[39m   [34mE:[39m 9            [34mI:[39m 1,000        [34mR:[39m 361.1        [34mS:[39m 0.0          [34mT:[39m 0:00:01
Pretraining agent on seed data...
[DEBUG] ÂéüÂßã shapes - obs: (4, 256, 39), action: (3, 256, 4), reward: (3, 256, 1)
[DEBUG] Ê£ÄÊµãÂà∞ time‚Äëfirst Â∏ÉÂ±ÄÔºåÂ∑≤ËΩ¨ÁΩÆÂà∞ batch‚Äëfirst
[DEBUG] ËΩ¨ÁΩÆÂêé shapes - obs: (256, 4, 39), action: (256, 3, 4), reward: (256, 3, 1)
[TIME] encode:    9.89 ms
[36mPROFILER: _td_target executed in 0.06ms (call 1)
[TIME] td_target:    8.03 ms
[DEBUG] dynamics_vectorized inputs: z0=torch.Size([256, 512]), action_seq=torch.Size([256, 3, 4])
[DEBUG] Tensor formats: z_roll=torch.Size([256, 3, 512]), all_mu=torch.Size([256, 3, 4])
[TIME] rollout:  684.46 ms
[TIME] compute Q:   10.77 ms
[TIME] reward loss:    9.97 ms
[TIME] value loss:    0.20 ms
[TIME] backward:   24.65 ms
[TIME] grad clipping:   16.76 ms
[TIME] optim.step:    0.12 ms
[TIME] _update total:  765.79 ms
----- Profiler Summary for _update method -----
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg    # of Calls
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                     CheckpointFunction         0.63%       4.764ms        85.83%     653.345ms      54.445ms       0.000us         0.00%      21.982ms       1.832ms            12
                             MooreExpertsModule_forward         0.00%       0.000us         0.00%       0.000us       0.000us      14.456ms        95.14%      14.456ms       7.228ms             2
                                           WorldModel_Q         0.00%       0.000us         0.00%       0.000us       0.000us      10.463ms        68.86%      10.463ms      10.463ms             1
                             MooreExpertsModule_forward         0.02%     187.740us         1.92%      14.617ms       7.309ms       0.000us         0.00%       8.949ms       4.475ms             2
                                              aten::bmm         1.37%      10.453ms         9.08%      69.079ms       1.234ms       6.718ms        44.22%       6.737ms     120.304us            56
                                            aten::copy_         0.07%     500.807us         0.83%       6.331ms      39.568us       4.601ms        30.28%       4.601ms      28.758us           160
void at::native::elementwise_kernel<128, 2, at::nati...         0.00%       0.000us         0.00%       0.000us       0.000us       4.406ms        29.00%       4.406ms     338.923us            13
                                           aten::repeat         0.90%       6.868ms         2.08%      15.854ms     660.601us       0.000us         0.00%       4.372ms     182.177us            24
void gemv2N_kernel<int, int, float, float, float, fl...         0.00%       0.000us         0.00%       0.000us       0.000us       4.126ms        27.15%       4.126ms       2.063ms             2
                                      WorldModel_reward         0.00%       0.000us         0.00%       0.000us       0.000us       3.073ms        20.22%       3.073ms       1.024ms             3
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
Self CPU time total: 761.188ms
Self CUDA time total: 15.194ms
----------------------------------------------
[36mPROFILER: _update executed in 1303.97ms (call 1)
[DEBUG] ÂéüÂßã shapes - obs: (4, 256, 39), action: (3, 256, 4), reward: (3, 256, 1)
[DEBUG] Ê£ÄÊµãÂà∞ time‚Äëfirst Â∏ÉÂ±ÄÔºåÂ∑≤ËΩ¨ÁΩÆÂà∞ batch‚Äëfirst
[DEBUG] ËΩ¨ÁΩÆÂêé shapes - obs: (256, 4, 39), action: (256, 3, 4), reward: (256, 3, 1)
[TIME] encode:   10.47 ms
[36mPROFILER: _td_target executed in 0.06ms (call 2)
[TIME] td_target:    5.01 ms
[DEBUG] dynamics_vectorized inputs: z0=torch.Size([256, 512]), action_seq=torch.Size([256, 3, 4])
[DEBUG] Tensor formats: z_roll=torch.Size([256, 3, 512]), all_mu=torch.Size([256, 3, 4])
[TIME] rollout:   11.61 ms
[TIME] compute Q:    7.68 ms
[TIME] reward loss:    6.05 ms
[TIME] value loss:    0.18 ms
[TIME] backward:    9.64 ms
[TIME] grad clipping:    0.78 ms
[TIME] optim.step:    0.05 ms
[TIME] _update total:   52.19 ms
----- Profiler Summary for _update method -----
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg    # of Calls
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                     CheckpointFunction         6.82%       3.388ms        77.45%      38.482ms       3.207ms       0.000us         0.00%      25.572ms       2.131ms            12
                             MooreExpertsModule_forward         0.00%       0.000us         0.00%       0.000us       0.000us      12.146ms        71.54%      12.146ms       6.073ms             2
                             MooreExpertsModule_forward         0.27%     131.887us        24.68%      12.262ms       6.131ms       0.000us         0.00%      10.742ms       5.371ms             2
                                           WorldModel_Q         0.00%       0.000us         0.00%       0.000us       0.000us       7.411ms        43.65%       7.411ms       7.411ms             1
                                              aten::bmm         0.34%     168.102us        18.89%       9.386ms     586.649us       7.286ms        42.91%       7.305ms     456.535us            16
                                            aten::copy_         0.62%     308.272us        15.33%       7.616ms      62.426us       5.829ms        34.33%       5.829ms      47.776us           122
void at::native::elementwise_kernel<128, 2, at::nati...         0.00%       0.000us         0.00%       0.000us       0.000us       5.635ms        33.19%       5.635ms     433.467us            13
                                           aten::repeat         0.05%      23.356us        11.47%       5.697ms       1.424ms       0.000us         0.00%       5.601ms       1.400ms             4
                                      WorldModel_reward         0.00%       0.000us         0.00%       0.000us       0.000us       4.797ms        28.25%       4.797ms       1.599ms             3
void gemv2N_kernel<int, int, float, float, float, fl...         0.00%       0.000us         0.00%       0.000us       0.000us       4.691ms        27.63%       4.691ms       2.345ms             2
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
Self CPU time total: 49.686ms
Self CUDA time total: 16.979ms
----------------------------------------------
[36mPROFILER: _update executed in 246.79ms (call 2)
[DEBUG] ÂéüÂßã shapes - obs: (4, 256, 39), action: (3, 256, 4), reward: (3, 256, 1)
[DEBUG] Ê£ÄÊµãÂà∞ time‚Äëfirst Â∏ÉÂ±ÄÔºåÂ∑≤ËΩ¨ÁΩÆÂà∞ batch‚Äëfirst
[DEBUG] ËΩ¨ÁΩÆÂêé shapes - obs: (256, 4, 39), action: (256, 3, 4), reward: (256, 3, 1)
[TIME] encode:    7.71 ms
[36mPROFILER: _td_target executed in 0.06ms (call 3)
[TIME] td_target:    6.97 ms
[DEBUG] dynamics_vectorized inputs: z0=torch.Size([256, 512]), action_seq=torch.Size([256, 3, 4])
[DEBUG] Tensor formats: z_roll=torch.Size([256, 3, 512]), all_mu=torch.Size([256, 3, 4])
[TIME] rollout:   11.16 ms
[TIME] compute Q:    7.64 ms
[TIME] reward loss:    3.49 ms
[TIME] value loss:    0.18 ms
[TIME] backward:   12.01 ms
[TIME] grad clipping:    0.70 ms
[TIME] optim.step:    0.06 ms
[TIME] _update total:   50.64 ms
----- Profiler Summary for _update method -----
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg    # of Calls
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                     CheckpointFunction         6.21%       3.000ms        71.55%      34.561ms       2.880ms       0.000us         0.00%      22.169ms       1.847ms            12
                             MooreExpertsModule_forward         0.00%       0.000us         0.00%       0.000us       0.000us      11.606ms        75.95%      11.606ms       5.803ms             2
                             MooreExpertsModule_forward         0.26%     127.126us        24.27%      11.721ms       5.861ms       0.000us         0.00%       9.043ms       4.522ms             2
                                           WorldModel_Q         0.00%       0.000us         0.00%       0.000us       0.000us       7.401ms        48.43%       7.401ms       7.401ms             1
                                              aten::bmm         0.33%     157.066us        15.52%       7.496ms     468.499us       7.123ms        46.61%       7.142ms     446.387us            16
void gemv2N_kernel<int, int, float, float, float, fl...         0.00%       0.000us         0.00%       0.000us       0.000us       4.460ms        29.18%       4.460ms       2.230ms             2
                                            aten::copy_         0.58%     279.550us        12.75%       6.159ms      50.480us       4.361ms        28.54%       4.361ms      35.742us           122
void at::native::elementwise_kernel<128, 2, at::nati...         0.00%       0.000us         0.00%       0.000us       0.000us       4.165ms        27.26%       4.165ms     320.405us            13
                                           aten::repeat         0.04%      19.174us         8.74%       4.220ms       1.055ms       0.000us         0.00%       4.132ms       1.033ms             4
                             Torch-Compiled Region: 3/0         0.14%      67.048us         9.71%       4.690ms       1.563ms       0.000us         0.00%       2.802ms     934.165us             3
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
Self CPU time total: 48.301ms
Self CUDA time total: 15.281ms
----------------------------------------------
[36mPROFILER: _update executed in 246.57ms (call 3)
[DEBUG] ÂéüÂßã shapes - obs: (4, 256, 39), action: (3, 256, 4), reward: (3, 256, 1)
[DEBUG] Ê£ÄÊµãÂà∞ time‚Äëfirst Â∏ÉÂ±ÄÔºåÂ∑≤ËΩ¨ÁΩÆÂà∞ batch‚Äëfirst
[DEBUG] ËΩ¨ÁΩÆÂêé shapes - obs: (256, 4, 39), action: (256, 3, 4), reward: (256, 3, 1)
[TIME] encode:    7.40 ms
[TIME] td_target:    7.05 ms
[DEBUG] dynamics_vectorized inputs: z0=torch.Size([256, 512]), action_seq=torch.Size([256, 3, 4])
[DEBUG] Tensor formats: z_roll=torch.Size([256, 3, 512]), all_mu=torch.Size([256, 3, 4])
[TIME] rollout:   11.27 ms
[TIME] compute Q:    7.71 ms
[TIME] reward loss:    3.44 ms
[TIME] value loss:    0.17 ms
[TIME] backward:   12.24 ms
[TIME] grad clipping:    0.71 ms
[TIME] optim.step:   26.60 ms
[TIME] _update total:   77.40 ms
----- Profiler Summary for _update method -----
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg    # of Calls
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                               Optimizer.step#Adam.step         0.00%       0.000us         0.00%       0.000us       0.000us      26.355ms       172.53%      26.355ms      26.355ms             1
                                     CheckpointFunction         4.02%       3.016ms        45.38%      34.030ms       2.836ms       0.000us         0.00%      21.602ms       1.800ms            12
                             MooreExpertsModule_forward         0.00%       0.000us         0.00%       0.000us       0.000us      11.030ms        72.21%      11.030ms       5.515ms             2
                             MooreExpertsModule_forward         0.17%     126.848us        14.86%      11.146ms       5.573ms       0.000us         0.00%       8.763ms       4.381ms             2
                                           WorldModel_Q         0.00%       0.000us         0.00%       0.000us       0.000us       7.472ms        48.92%       7.472ms       7.472ms             1
                                              aten::bmm         0.21%     160.198us         9.59%       7.192ms     449.509us       6.814ms        44.60%       6.833ms     427.053us            16
                                            aten::copy_         0.39%     292.455us         8.41%       6.305ms      51.683us       4.378ms        28.66%       4.378ms      35.887us           122
void at::native::elementwise_kernel<128, 2, at::nati...         0.00%       0.000us         0.00%       0.000us       0.000us       4.184ms        27.39%       4.184ms     321.810us            13
void gemv2N_kernel<int, int, float, float, float, fl...         0.00%       0.000us         0.00%       0.000us       0.000us       4.162ms        27.25%       4.162ms       2.081ms             2
                                           aten::repeat         0.03%      20.119us         5.65%       4.238ms       1.060ms       0.000us         0.00%       4.150ms       1.037ms             4
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
Self CPU time total: 74.995ms
Self CUDA time total: 15.275ms
----------------------------------------------
[DEBUG] ÂéüÂßã shapes - obs: (4, 256, 39), action: (3, 256, 4), reward: (3, 256, 1)
[DEBUG] Ê£ÄÊµãÂà∞ time‚Äëfirst Â∏ÉÂ±ÄÔºåÂ∑≤ËΩ¨ÁΩÆÂà∞ batch‚Äëfirst
[DEBUG] ËΩ¨ÁΩÆÂêé shapes - obs: (256, 4, 39), action: (256, 3, 4), reward: (256, 3, 1)
[TIME] encode:    7.04 ms
[TIME] td_target:    7.27 ms
[DEBUG] dynamics_vectorized inputs: z0=torch.Size([256, 512]), action_seq=torch.Size([256, 3, 4])
[DEBUG] Tensor formats: z_roll=torch.Size([256, 3, 512]), all_mu=torch.Size([256, 3, 4])
[TIME] rollout:   11.25 ms
[TIME] compute Q:    8.10 ms
[TIME] reward loss:    3.86 ms
[TIME] value loss:    0.18 ms
[TIME] backward:   12.55 ms
[TIME] grad clipping:    1.04 ms
[TIME] optim.step:    1.03 ms
[TIME] _update total:   53.14 ms
----- Profiler Summary for _update method -----
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg    # of Calls
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                     CheckpointFunction         4.99%       2.518ms        69.13%      34.869ms       2.906ms       0.000us         0.00%      21.858ms       1.822ms            12
                             MooreExpertsModule_forward         0.00%       0.000us         0.00%       0.000us       0.000us      11.399ms        74.21%      11.399ms       5.699ms             2
                             MooreExpertsModule_forward         0.27%     134.677us        23.19%      11.700ms       5.850ms       0.000us         0.00%       8.896ms       4.448ms             2
                                           WorldModel_Q         0.00%       0.000us         0.00%       0.000us       0.000us       7.835ms        51.00%       7.835ms       7.835ms             1
                                              aten::bmm         0.33%     167.694us        16.44%       8.294ms     518.364us       6.725ms        43.78%       6.744ms     421.482us            16
                                            aten::copy_         0.60%     300.384us        11.63%       5.867ms      48.094us       4.520ms        29.43%       4.520ms      37.053us           122
void at::native::elementwise_kernel<128, 2, at::nati...         0.00%       0.000us         0.00%       0.000us       0.000us       4.326ms        28.16%       4.326ms     332.757us            13
                                           aten::repeat         0.04%      22.307us         8.70%       4.387ms       1.097ms       0.000us         0.00%       4.292ms       1.073ms             4
void gemv2N_kernel<int, int, float, float, float, fl...         0.00%       0.000us         0.00%       0.000us       0.000us       4.150ms        27.02%       4.150ms       2.075ms             2
                             Torch-Compiled Region: 3/0         0.13%      64.863us         9.73%       4.910ms       1.637ms       0.000us         0.00%       2.825ms     941.675us             3
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
Self CPU time total: 50.442ms
Self CUDA time total: 15.361ms
----------------------------------------------
[DEBUG] ÂéüÂßã shapes - obs: (4, 256, 39), action: (3, 256, 4), reward: (3, 256, 1)
[DEBUG] Ê£ÄÊµãÂà∞ time‚Äëfirst Â∏ÉÂ±ÄÔºåÂ∑≤ËΩ¨ÁΩÆÂà∞ batch‚Äëfirst
[DEBUG] ËΩ¨ÁΩÆÂêé shapes - obs: (256, 4, 39), action: (256, 3, 4), reward: (256, 3, 1)
[TIME] encode:    6.80 ms
[TIME] td_target:    6.82 ms
[DEBUG] dynamics_vectorized inputs: z0=torch.Size([256, 512]), action_seq=torch.Size([256, 3, 4])
[DEBUG] Tensor formats: z_roll=torch.Size([256, 3, 512]), all_mu=torch.Size([256, 3, 4])
[TIME] rollout:   11.34 ms
[TIME] compute Q:    7.92 ms
[TIME] reward loss:    3.44 ms
[TIME] value loss:    0.17 ms
[TIME] backward:   11.94 ms
[TIME] grad clipping:    0.71 ms
[TIME] optim.step:    1.00 ms
[TIME] _update total:   50.93 ms
----- Profiler Summary for _update method -----
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg    # of Calls
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                     CheckpointFunction         4.90%       2.377ms        67.89%      32.966ms       2.747ms       0.000us         0.00%      21.665ms       1.805ms            12
                             MooreExpertsModule_forward         0.00%       0.000us         0.00%       0.000us       0.000us      10.585ms        69.35%      10.585ms       5.293ms             2
                             MooreExpertsModule_forward         0.27%     131.161us        22.05%      10.704ms       5.352ms       0.000us         0.00%       8.792ms       4.396ms             2
                                           WorldModel_Q         0.00%       0.000us         0.00%       0.000us       0.000us       7.679ms        50.31%       7.679ms       7.679ms             1
                                              aten::bmm         0.33%     158.923us        14.78%       7.177ms     448.578us       6.805ms        44.59%       6.824ms     426.502us            16
                                            aten::copy_         0.59%     287.011us        15.29%       7.423ms      60.844us       4.419ms        28.95%       4.419ms      36.219us           122
void at::native::elementwise_kernel<128, 2, at::nati...         0.00%       0.000us         0.00%       0.000us       0.000us       4.225ms        27.68%       4.225ms     324.993us            13
                                           aten::repeat         0.04%      19.531us         8.82%       4.281ms       1.070ms       0.000us         0.00%       4.191ms       1.048ms             4
void gemv2N_kernel<int, int, float, float, float, fl...         0.00%       0.000us         0.00%       0.000us       0.000us       4.153ms        27.21%       4.153ms       2.076ms             2
                             Torch-Compiled Region: 3/0         0.13%      63.884us        10.49%       5.093ms       1.698ms       0.000us         0.00%       2.802ms     933.983us             3
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
Self CPU time total: 48.555ms
Self CUDA time total: 15.263ms
----------------------------------------------
[DEBUG] ÂéüÂßã shapes - obs: (4, 256, 39), action: (3, 256, 4), reward: (3, 256, 1)
[DEBUG] Ê£ÄÊµãÂà∞ time‚Äëfirst Â∏ÉÂ±ÄÔºåÂ∑≤ËΩ¨ÁΩÆÂà∞ batch‚Äëfirst
[DEBUG] ËΩ¨ÁΩÆÂêé shapes - obs: (256, 4, 39), action: (256, 3, 4), reward: (256, 3, 1)
[TIME] encode:    7.33 ms
[TIME] td_target:    4.97 ms
[DEBUG] dynamics_vectorized inputs: z0=torch.Size([256, 512]), action_seq=torch.Size([256, 3, 4])
[DEBUG] Tensor formats: z_roll=torch.Size([256, 3, 512]), all_mu=torch.Size([256, 3, 4])
[TIME] rollout:   11.70 ms
[TIME] compute Q:    7.65 ms
[TIME] reward loss:    3.43 ms
[TIME] value loss:    0.17 ms
[TIME] backward:    9.68 ms
[TIME] grad clipping:    0.92 ms
[TIME] optim.step:    1.05 ms
[TIME] _update total:   47.69 ms
----- Profiler Summary for _update method -----
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg    # of Calls
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                     CheckpointFunction         5.26%       2.384ms        68.39%      31.007ms       2.584ms       0.000us         0.00%      22.182ms       1.848ms            12
                             MooreExpertsModule_forward         0.00%       0.000us         0.00%       0.000us       0.000us       9.832ms        63.37%       9.832ms       4.916ms             2
                             MooreExpertsModule_forward         0.34%     152.118us        21.95%       9.955ms       4.977ms       0.000us         0.00%       9.049ms       4.524ms             2
                                           WorldModel_Q         0.00%       0.000us         0.00%       0.000us       0.000us       7.413ms        47.78%       7.413ms       7.413ms             1
                                              aten::bmm         0.37%     169.374us        16.94%       7.679ms     479.916us       7.072ms        45.58%       7.091ms     443.165us            16
void gemv2N_kernel<int, int, float, float, float, fl...         0.00%       0.000us         0.00%       0.000us       0.000us       4.440ms        28.62%       4.440ms       2.220ms             2
                                            aten::copy_         0.65%     293.808us        12.65%       5.733ms      46.995us       4.394ms        28.33%       4.394ms      36.019us           122
void at::native::elementwise_kernel<128, 2, at::nati...         0.00%       0.000us         0.00%       0.000us       0.000us       4.201ms        27.08%       4.201ms     323.149us            13
                                           aten::repeat         0.05%      23.147us         9.43%       4.274ms       1.068ms       0.000us         0.00%       4.167ms       1.042ms             4
                             Torch-Compiled Region: 3/0         0.15%      66.848us        11.50%       5.216ms       1.739ms       0.000us         0.00%       2.807ms     935.615us             3
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
Self CPU time total: 45.342ms
Self CUDA time total: 15.514ms
----------------------------------------------
[DEBUG] ÂéüÂßã shapes - obs: (4, 256, 39), action: (3, 256, 4), reward: (3, 256, 1)
[DEBUG] Ê£ÄÊµãÂà∞ time‚Äëfirst Â∏ÉÂ±ÄÔºåÂ∑≤ËΩ¨ÁΩÆÂà∞ batch‚Äëfirst
[DEBUG] ËΩ¨ÁΩÆÂêé shapes - obs: (256, 4, 39), action: (256, 3, 4), reward: (256, 3, 1)
[TIME] encode:    6.83 ms
[TIME] td_target:    5.12 ms
[DEBUG] dynamics_vectorized inputs: z0=torch.Size([256, 512]), action_seq=torch.Size([256, 3, 4])
[DEBUG] Tensor formats: z_roll=torch.Size([256, 3, 512]), all_mu=torch.Size([256, 3, 4])
[TIME] rollout:   11.34 ms
[TIME] compute Q:    7.61 ms
[TIME] reward loss:    3.63 ms
[TIME] value loss:    0.17 ms
[TIME] backward:    9.83 ms
[TIME] grad clipping:    0.83 ms
[TIME] optim.step:    1.08 ms
[TIME] _update total:   47.14 ms
----- Profiler Summary for _update method -----
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg    # of Calls
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                     CheckpointFunction         5.56%       2.480ms        68.03%      30.334ms       2.528ms       0.000us         0.00%      21.594ms       1.799ms            12
                             MooreExpertsModule_forward         0.00%       0.000us         0.00%       0.000us       0.000us       9.403ms        61.74%       9.403ms       4.701ms             2
                             MooreExpertsModule_forward         0.32%     140.516us        21.37%       9.526ms       4.763ms       0.000us         0.00%       8.741ms       4.370ms             2
                                           WorldModel_Q         0.00%       0.000us         0.00%       0.000us       0.000us       7.339ms        48.19%       7.339ms       7.339ms             1
                                              aten::bmm         0.38%     168.436us        16.62%       7.411ms     463.185us       6.718ms        44.11%       6.736ms     421.025us            16
                                            aten::copy_         0.66%     294.534us        11.95%       5.330ms      43.689us       4.404ms        28.92%       4.404ms      36.102us           122
void at::native::elementwise_kernel<128, 2, at::nati...         0.00%       0.000us         0.00%       0.000us       0.000us       4.212ms        27.66%       4.212ms     324.011us            13
                                           aten::repeat         0.05%      22.889us         9.59%       4.275ms       1.069ms       0.000us         0.00%       4.178ms       1.045ms             4
void gemv2N_kernel<int, int, float, float, float, fl...         0.00%       0.000us         0.00%       0.000us       0.000us       4.124ms        27.08%       4.124ms       2.062ms             2
                             Torch-Compiled Region: 3/0         0.15%      68.221us        11.54%       5.147ms       1.716ms       0.000us         0.00%       2.830ms     943.202us             3
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
Self CPU time total: 44.587ms
Self CUDA time total: 15.231ms
----------------------------------------------
[DEBUG] ÂéüÂßã shapes - obs: (4, 256, 39), action: (3, 256, 4), reward: (3, 256, 1)
[DEBUG] Ê£ÄÊµãÂà∞ time‚Äëfirst Â∏ÉÂ±ÄÔºåÂ∑≤ËΩ¨ÁΩÆÂà∞ batch‚Äëfirst
[DEBUG] ËΩ¨ÁΩÆÂêé shapes - obs: (256, 4, 39), action: (256, 3, 4), reward: (256, 3, 1)
[TIME] encode:    6.90 ms
[TIME] td_target:    5.12 ms
[DEBUG] dynamics_vectorized inputs: z0=torch.Size([256, 512]), action_seq=torch.Size([256, 3, 4])
[DEBUG] Tensor formats: z_roll=torch.Size([256, 3, 512]), all_mu=torch.Size([256, 3, 4])
[TIME] rollout:   11.41 ms
[TIME] compute Q:    7.88 ms
[TIME] reward loss:    3.47 ms
[TIME] value loss:    0.17 ms
[TIME] backward:   10.10 ms
[TIME] grad clipping:    0.68 ms
[TIME] optim.step:    1.00 ms
[TIME] _update total:   47.52 ms
----- Profiler Summary for _update method -----
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg    # of Calls
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                     CheckpointFunction         5.29%       2.392ms        67.24%      30.388ms       2.532ms       0.000us         0.00%      21.670ms       1.806ms            12
                             MooreExpertsModule_forward         0.00%       0.000us         0.00%       0.000us       0.000us       9.485ms        62.14%       9.485ms       4.743ms             2
                             MooreExpertsModule_forward         0.28%     128.512us        21.25%       9.602ms       4.801ms       0.000us         0.00%       8.789ms       4.394ms             2
                                           WorldModel_Q         0.00%       0.000us         0.00%       0.000us       0.000us       7.642ms        50.06%       7.642ms       7.642ms             1
                                              aten::bmm         0.35%     158.155us        16.16%       7.304ms     456.512us       6.794ms        44.51%       6.813ms     425.812us            16
                                            aten::copy_         0.63%     284.626us        11.80%       5.335ms      43.726us       4.410ms        28.89%       4.410ms      36.148us           122
void at::native::elementwise_kernel<128, 2, at::nati...         0.00%       0.000us         0.00%       0.000us       0.000us       4.217ms        27.63%       4.217ms     324.378us            13
                                           aten::repeat         0.04%      19.650us         9.45%       4.272ms       1.068ms       0.000us         0.00%       4.183ms       1.046ms             4
void gemv2N_kernel<int, int, float, float, float, fl...         0.00%       0.000us         0.00%       0.000us       0.000us       4.163ms        27.27%       4.163ms       2.081ms             2
                             Torch-Compiled Region: 3/0         0.14%      64.897us        11.48%       5.189ms       1.730ms       0.000us         0.00%       2.812ms     937.418us             3
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
Self CPU time total: 45.194ms
Self CUDA time total: 15.264ms
----------------------------------------------
[DEBUG] ÂéüÂßã shapes - obs: (4, 256, 39), action: (3, 256, 4), reward: (3, 256, 1)
[DEBUG] Ê£ÄÊµãÂà∞ time‚Äëfirst Â∏ÉÂ±ÄÔºåÂ∑≤ËΩ¨ÁΩÆÂà∞ batch‚Äëfirst
[DEBUG] ËΩ¨ÁΩÆÂêé shapes - obs: (256, 4, 39), action: (256, 3, 4), reward: (256, 3, 1)
[TIME] encode:    6.82 ms
[TIME] td_target:    4.90 ms
[DEBUG] dynamics_vectorized inputs: z0=torch.Size([256, 512]), action_seq=torch.Size([256, 3, 4])
[DEBUG] Tensor formats: z_roll=torch.Size([256, 3, 512]), all_mu=torch.Size([256, 3, 4])
[TIME] rollout:   11.59 ms
[TIME] compute Q:    7.87 ms
[TIME] reward loss:    3.46 ms
[TIME] value loss:    0.17 ms
[TIME] backward:    9.57 ms
[TIME] grad clipping:    0.70 ms
[TIME] optim.step:    1.80 ms
[TIME] _update total:   47.67 ms
----- Profiler Summary for _update method -----
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg    # of Calls
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                     CheckpointFunction         5.34%       2.421ms        66.35%      30.064ms       2.505ms       0.000us         0.00%      21.613ms       1.801ms            12
                             MooreExpertsModule_forward         0.00%       0.000us         0.00%       0.000us       0.000us       9.231ms        60.53%       9.231ms       4.616ms             2
                             MooreExpertsModule_forward         0.29%     130.490us        20.64%       9.352ms       4.676ms       0.000us         0.00%       8.761ms       4.380ms             2
                                           WorldModel_Q         0.00%       0.000us         0.00%       0.000us       0.000us       7.633ms        50.05%       7.633ms       7.633ms             1
                                              aten::bmm         0.35%     160.217us        16.14%       7.312ms     457.026us       6.778ms        44.44%       6.797ms     424.804us            16
                                            aten::copy_         0.63%     286.836us        12.07%       5.470ms      44.836us       4.399ms        28.84%       4.399ms      36.054us           122
void at::native::elementwise_kernel<128, 2, at::nati...         0.00%       0.000us         0.00%       0.000us       0.000us       4.206ms        27.58%       4.206ms     323.531us            13
                                           aten::repeat         0.04%      19.587us         9.40%       4.260ms       1.065ms       0.000us         0.00%       4.172ms       1.043ms             4
void gemv2N_kernel<int, int, float, float, float, fl...         0.00%       0.000us         0.00%       0.000us       0.000us       4.142ms        27.16%       4.142ms       2.071ms             2
                             Torch-Compiled Region: 3/0         0.14%      65.328us        11.91%       5.396ms       1.799ms       0.000us         0.00%       2.808ms     936.031us             3
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
Self CPU time total: 45.310ms
Self CUDA time total: 15.251ms
----------------------------------------------
[DEBUG] ÂéüÂßã shapes - obs: (4, 256, 39), action: (3, 256, 4), reward: (3, 256, 1)
[DEBUG] Ê£ÄÊµãÂà∞ time‚Äëfirst Â∏ÉÂ±ÄÔºåÂ∑≤ËΩ¨ÁΩÆÂà∞ batch‚Äëfirst
[DEBUG] ËΩ¨ÁΩÆÂêé shapes - obs: (256, 4, 39), action: (256, 3, 4), reward: (256, 3, 1)
[TIME] encode:    6.90 ms
[TIME] td_target:    5.34 ms
[DEBUG] dynamics_vectorized inputs: z0=torch.Size([256, 512]), action_seq=torch.Size([256, 3, 4])
[DEBUG] Tensor formats: z_roll=torch.Size([256, 3, 512]), all_mu=torch.Size([256, 3, 4])
[TIME] rollout:   11.29 ms
[TIME] compute Q:    8.01 ms
[TIME] reward loss:    3.64 ms
[TIME] value loss:    0.17 ms
[TIME] backward:   10.83 ms
[TIME] grad clipping:    0.77 ms
[TIME] optim.step:    1.01 ms
[TIME] _update total:   48.77 ms
----- Profiler Summary for _update method -----
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg    # of Calls
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                     CheckpointFunction         5.45%       2.513ms        66.71%      30.739ms       2.562ms       0.000us         0.00%      21.645ms       1.804ms            12
                             MooreExpertsModule_forward         0.00%       0.000us         0.00%       0.000us       0.000us       9.625ms        63.15%       9.625ms       4.812ms             2
                             MooreExpertsModule_forward         0.30%     139.975us        21.17%       9.754ms       4.877ms       0.000us         0.00%       8.782ms       4.391ms             2
                                           WorldModel_Q         0.00%       0.000us         0.00%       0.000us       0.000us       7.748ms        50.83%       7.748ms       7.748ms             1
                                              aten::bmm         0.36%     163.652us        15.71%       7.237ms     452.330us       6.841ms        44.88%       6.860ms     428.745us            16
                                            aten::copy_         0.66%     304.892us        12.10%       5.576ms      45.703us       4.364ms        28.63%       4.364ms      35.766us           122
void gemv2N_kernel<int, int, float, float, float, fl...         0.00%       0.000us         0.00%       0.000us       0.000us       4.194ms        27.52%       4.194ms       2.097ms             2
void at::native::elementwise_kernel<128, 2, at::nati...         0.00%       0.000us         0.00%       0.000us       0.000us       4.171ms        27.37%       4.171ms     320.831us            13
                                           aten::repeat         0.05%      21.949us         9.19%       4.236ms       1.059ms       0.000us         0.00%       4.137ms       1.034ms             4
                             Torch-Compiled Region: 3/0         0.16%      74.546us        10.92%       5.032ms       1.677ms       0.000us         0.00%       2.811ms     936.960us             3
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
Self CPU time total: 46.080ms
Self CUDA time total: 15.241ms
----------------------------------------------
[DEBUG] ÂéüÂßã shapes - obs: (4, 256, 39), action: (3, 256, 4), reward: (3, 256, 1)
[DEBUG] Ê£ÄÊµãÂà∞ time‚Äëfirst Â∏ÉÂ±ÄÔºåÂ∑≤ËΩ¨ÁΩÆÂà∞ batch‚Äëfirst
[DEBUG] ËΩ¨ÁΩÆÂêé shapes - obs: (256, 4, 39), action: (256, 3, 4), reward: (256, 3, 1)
[TIME] encode:    9.25 ms
[TIME] td_target:    4.87 ms
[DEBUG] dynamics_vectorized inputs: z0=torch.Size([256, 512]), action_seq=torch.Size([256, 3, 4])
[DEBUG] Tensor formats: z_roll=torch.Size([256, 3, 512]), all_mu=torch.Size([256, 3, 4])
[TIME] rollout:   11.44 ms
[TIME] compute Q:    7.86 ms
[TIME] reward loss:    6.44 ms
[TIME] value loss:    0.17 ms
[TIME] backward:    9.45 ms
[TIME] grad clipping:    0.67 ms
[TIME] optim.step:    1.02 ms
[TIME] _update total:   51.97 ms
----- Profiler Summary for _update method -----
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg    # of Calls
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                     CheckpointFunction         4.90%       2.430ms        74.35%      36.862ms       3.072ms       0.000us         0.00%      25.412ms       2.118ms            12
                             MooreExpertsModule_forward         0.00%       0.000us         0.00%       0.000us       0.000us      11.674ms        68.16%      11.674ms       5.837ms             2
                             MooreExpertsModule_forward         0.26%     130.149us        23.79%      11.792ms       5.896ms       0.000us         0.00%      10.662ms       5.331ms             2
                                           WorldModel_Q         0.00%       0.000us         0.00%       0.000us       0.000us       7.625ms        44.52%       7.625ms       7.625ms             1
                                              aten::bmm         0.33%     161.437us        17.63%       8.742ms     546.392us       7.353ms        42.93%       7.372ms     460.725us            16
                                            aten::copy_         0.57%     282.791us        13.87%       6.876ms      56.357us       5.693ms        33.24%       5.693ms      46.663us           122
void at::native::elementwise_kernel<128, 2, at::nati...         0.00%       0.000us         0.00%       0.000us       0.000us       5.500ms        32.11%       5.500ms     423.040us            13
                                           aten::repeat         0.04%      20.697us        11.21%       5.555ms       1.389ms       0.000us         0.00%       5.466ms       1.367ms             4
                                      WorldModel_reward         0.00%       0.000us         0.00%       0.000us       0.000us       5.034ms        29.39%       5.034ms       1.678ms             3
void gemv2N_kernel<int, int, float, float, float, fl...         0.00%       0.000us         0.00%       0.000us       0.000us       4.745ms        27.70%       4.745ms       2.373ms             2
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
Self CPU time total: 49.579ms
Self CUDA time total: 17.128ms
----------------------------------------------
[DEBUG] ÂéüÂßã shapes - obs: (4, 256, 39), action: (3, 256, 4), reward: (3, 256, 1)
[DEBUG] Ê£ÄÊµãÂà∞ time‚Äëfirst Â∏ÉÂ±ÄÔºåÂ∑≤ËΩ¨ÁΩÆÂà∞ batch‚Äëfirst
[DEBUG] ËΩ¨ÁΩÆÂêé shapes - obs: (256, 4, 39), action: (256, 3, 4), reward: (256, 3, 1)
[TIME] encode:    7.15 ms
[TIME] td_target:    5.36 ms
[DEBUG] dynamics_vectorized inputs: z0=torch.Size([256, 512]), action_seq=torch.Size([256, 3, 4])
[DEBUG] Tensor formats: z_roll=torch.Size([256, 3, 512]), all_mu=torch.Size([256, 3, 4])
[TIME] rollout:   11.52 ms
[TIME] compute Q:    7.76 ms
[TIME] reward loss:    3.66 ms
[TIME] value loss:    0.19 ms
[TIME] backward:   10.25 ms
[TIME] grad clipping:    0.68 ms
[TIME] optim.step:    1.00 ms
[TIME] _update total:   48.38 ms
----- Profiler Summary for _update method -----
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg    # of Calls
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                     CheckpointFunction         5.23%       2.405ms        67.93%      31.233ms       2.603ms       0.000us         0.00%      21.921ms       1.827ms            12
                             MooreExpertsModule_forward         0.00%       0.000us         0.00%       0.000us       0.000us       9.725ms        63.02%       9.725ms       4.863ms             2
                             MooreExpertsModule_forward         0.28%     128.100us        21.41%       9.843ms       4.922ms       0.000us         0.00%       8.878ms       4.439ms             2
                                           WorldModel_Q         0.00%       0.000us         0.00%       0.000us       0.000us       7.517ms        48.71%       7.517ms       7.517ms             1
                                              aten::bmm         0.35%     159.312us        16.22%       7.456ms     466.030us       6.797ms        44.04%       6.815ms     425.967us            16
                                            aten::copy_         0.62%     284.109us        12.46%       5.730ms      46.970us       4.519ms        29.29%       4.519ms      37.044us           122
void at::native::elementwise_kernel<128, 2, at::nati...         0.00%       0.000us         0.00%       0.000us       0.000us       4.326ms        28.03%       4.326ms     332.782us            13
                                           aten::repeat         0.04%      19.533us         9.53%       4.384ms       1.096ms       0.000us         0.00%       4.292ms       1.073ms             4
void gemv2N_kernel<int, int, float, float, float, fl...         0.00%       0.000us         0.00%       0.000us       0.000us       4.136ms        26.80%       4.136ms       2.068ms             2
                             Torch-Compiled Region: 3/0         0.14%      64.208us        11.00%       5.058ms       1.686ms       0.000us         0.00%       2.887ms     962.444us             3
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
Self CPU time total: 45.981ms
Self CUDA time total: 15.432ms
----------------------------------------------
[DEBUG] ÂéüÂßã shapes - obs: (4, 256, 39), action: (3, 256, 4), reward: (3, 256, 1)
[DEBUG] Ê£ÄÊµãÂà∞ time‚Äëfirst Â∏ÉÂ±ÄÔºåÂ∑≤ËΩ¨ÁΩÆÂà∞ batch‚Äëfirst
[DEBUG] ËΩ¨ÁΩÆÂêé shapes - obs: (256, 4, 39), action: (256, 3, 4), reward: (256, 3, 1)
[TIME] encode:    6.92 ms
[TIME] td_target:    4.94 ms
[DEBUG] dynamics_vectorized inputs: z0=torch.Size([256, 512]), action_seq=torch.Size([256, 3, 4])
[DEBUG] Tensor formats: z_roll=torch.Size([256, 3, 512]), all_mu=torch.Size([256, 3, 4])
[TIME] rollout:   11.57 ms
[TIME] compute Q:    7.91 ms
[TIME] reward loss:    3.67 ms
[TIME] value loss:    0.18 ms
[TIME] backward:   10.40 ms
[TIME] grad clipping:    0.80 ms
[TIME] optim.step:    1.28 ms
[TIME] _update total:   48.49 ms
----- Profiler Summary for _update method -----
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg    # of Calls
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                     CheckpointFunction         5.67%       2.594ms        66.15%      30.284ms       2.524ms       0.000us         0.00%      21.537ms       1.795ms            12
                             MooreExpertsModule_forward         0.00%       0.000us         0.00%       0.000us       0.000us       9.202ms        60.54%       9.202ms       4.601ms             2
                             MooreExpertsModule_forward         0.30%     136.407us        20.39%       9.333ms       4.666ms       0.000us         0.00%       8.717ms       4.358ms             2
                                           WorldModel_Q         0.00%       0.000us         0.00%       0.000us       0.000us       7.661ms        50.40%       7.661ms       7.661ms             1
                                              aten::bmm         0.36%     164.400us        16.38%       7.499ms     468.687us       6.847ms        45.05%       6.867ms     429.193us            16
                                            aten::copy_         0.67%     308.064us        11.84%       5.422ms      44.441us       4.340ms        28.56%       4.340ms      35.576us           122
void gemv2N_kernel<int, int, float, float, float, fl...         0.00%       0.000us         0.00%       0.000us       0.000us       4.154ms        27.33%       4.154ms       2.077ms             2
void at::native::elementwise_kernel<128, 2, at::nati...         0.00%       0.000us         0.00%       0.000us       0.000us       4.146ms        27.28%       4.146ms     318.955us            13
                                           aten::repeat         0.05%      22.910us         9.20%       4.211ms       1.053ms       0.000us         0.00%       4.113ms       1.028ms             4
                             Torch-Compiled Region: 3/0         0.16%      72.737us        11.61%       5.315ms       1.772ms       0.000us         0.00%       2.830ms     943.308us             3
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
Self CPU time total: 45.777ms
Self CUDA time total: 15.200ms
----------------------------------------------
[DEBUG] ÂéüÂßã shapes - obs: (4, 256, 39), action: (3, 256, 4), reward: (3, 256, 1)
[DEBUG] Ê£ÄÊµãÂà∞ time‚Äëfirst Â∏ÉÂ±ÄÔºåÂ∑≤ËΩ¨ÁΩÆÂà∞ batch‚Äëfirst
[DEBUG] ËΩ¨ÁΩÆÂêé shapes - obs: (256, 4, 39), action: (256, 3, 4), reward: (256, 3, 1)
[TIME] encode:    7.46 ms
[TIME] td_target:    5.13 ms
[DEBUG] dynamics_vectorized inputs: z0=torch.Size([256, 512]), action_seq=torch.Size([256, 3, 4])
[DEBUG] Tensor formats: z_roll=torch.Size([256, 3, 512]), all_mu=torch.Size([256, 3, 4])
[TIME] rollout:   11.13 ms
[TIME] compute Q:    7.74 ms
[TIME] reward loss:    3.52 ms
[TIME] value loss:    0.18 ms
[TIME] backward:   10.37 ms
[TIME] grad clipping:    0.68 ms
[TIME] optim.step:    1.00 ms
[TIME] _update total:   48.01 ms
----- Profiler Summary for _update method -----
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg    # of Calls
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                     CheckpointFunction         5.23%       2.388ms        68.34%      31.202ms       2.600ms       0.000us         0.00%      22.139ms       1.845ms            12
                             MooreExpertsModule_forward         0.00%       0.000us         0.00%       0.000us       0.000us      10.161ms        65.56%      10.161ms       5.080ms             2
                             MooreExpertsModule_forward         0.28%     129.414us        22.51%      10.277ms       5.138ms       0.000us         0.00%       9.031ms       4.515ms             2
                                           WorldModel_Q         0.00%       0.000us         0.00%       0.000us       0.000us       7.490ms        48.33%       7.490ms       7.490ms             1
                                              aten::bmm         0.35%     159.531us        17.02%       7.773ms     485.817us       6.995ms        45.13%       7.014ms     438.365us            16
void gemv2N_kernel<int, int, float, float, float, fl...         0.00%       0.000us         0.00%       0.000us       0.000us       4.434ms        28.61%       4.434ms       2.217ms             2
                                            aten::copy_         0.62%     283.951us        12.78%       5.836ms      47.833us       4.426ms        28.56%       4.426ms      36.278us           122
void at::native::elementwise_kernel<128, 2, at::nati...         0.00%       0.000us         0.00%       0.000us       0.000us       4.232ms        27.30%       4.232ms     325.508us            13
                                           aten::repeat         0.04%      20.044us         9.39%       4.288ms       1.072ms       0.000us         0.00%       4.198ms       1.049ms             4
                             Torch-Compiled Region: 3/0         0.15%      66.209us        10.36%       4.732ms       1.577ms       0.000us         0.00%       2.813ms     937.579us             3
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
Self CPU time total: 45.658ms
Self CUDA time total: 15.499ms
----------------------------------------------
[DEBUG] ÂéüÂßã shapes - obs: (4, 256, 39), action: (3, 256, 4), reward: (3, 256, 1)
[DEBUG] Ê£ÄÊµãÂà∞ time‚Äëfirst Â∏ÉÂ±ÄÔºåÂ∑≤ËΩ¨ÁΩÆÂà∞ batch‚Äëfirst
[DEBUG] ËΩ¨ÁΩÆÂêé shapes - obs: (256, 4, 39), action: (256, 3, 4), reward: (256, 3, 1)
[TIME] encode:    6.88 ms
[TIME] td_target:    5.68 ms
[DEBUG] dynamics_vectorized inputs: z0=torch.Size([256, 512]), action_seq=torch.Size([256, 3, 4])
[DEBUG] Tensor formats: z_roll=torch.Size([256, 3, 512]), all_mu=torch.Size([256, 3, 4])
[TIME] rollout:   11.10 ms
[TIME] compute Q:    7.98 ms
[TIME] reward loss:    3.52 ms
[TIME] value loss:    0.17 ms
[TIME] backward:   10.72 ms
[TIME] grad clipping:    0.74 ms
[TIME] optim.step:    1.00 ms
[TIME] _update total:   48.59 ms
----- Profiler Summary for _update method -----
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg    # of Calls
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                                     CheckpointFunction         5.34%       2.457ms        66.51%      30.615ms       2.551ms       0.000us         0.00%      21.784ms       1.815ms            12
                             MooreExpertsModule_forward         0.00%       0.000us         0.00%       0.000us       0.000us       9.479ms        61.86%       9.479ms       4.740ms             2
                             MooreExpertsModule_forward         0.30%     139.261us        20.87%       9.604ms       4.802ms       0.000us         0.00%       8.845ms       4.422ms             2
                                           WorldModel_Q         0.00%       0.000us         0.00%       0.000us       0.000us       7.717ms        50.36%       7.717ms       7.717ms             1
                                              aten::bmm         0.37%     170.326us        16.11%       7.416ms     463.523us       6.750ms        44.05%       6.768ms     423.029us            16
                                            aten::copy_         0.64%     294.960us        12.77%       5.878ms      48.180us       4.519ms        29.49%       4.519ms      37.041us           122
void at::native::elementwise_kernel<128, 2, at::nati...         0.00%       0.000us         0.00%       0.000us       0.000us       4.325ms        28.23%       4.325ms     332.708us            13
                                           aten::repeat         0.05%      23.602us         9.55%       4.394ms       1.099ms       0.000us         0.00%       4.292ms       1.073ms             4
void gemv2N_kernel<int, int, float, float, float, fl...         0.00%       0.000us         0.00%       0.000us       0.000us       4.133ms        26.97%       4.133ms       2.066ms             2
                             Torch-Compiled Region: 3/0         0.17%      80.062us        10.49%       4.827ms       1.609ms       0.000us         0.00%       2.812ms     937.460us             3
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
Self CPU time total: 46.029ms
Self CUDA time total: 15.324ms
----------------------------------------------
[DEBUG] ÂéüÂßã shapes - obs: (4, 256, 39), action: (3, 256, 4), reward: (3, 256, 1)
[DEBUG] Ê£ÄÊµãÂà∞ time‚Äëfirst Â∏ÉÂ±ÄÔºåÂ∑≤ËΩ¨ÁΩÆÂà∞ batch‚Äëfirst
[DEBUG] ËΩ¨ÁΩÆÂêé shapes - obs: (256, 4, 39), action: (256, 3, 4), reward: (256, 3, 1)
[TIME] encode:    6.75 ms
[TIME] td_target:    5.18 ms
[DEBUG] dynamics_vectorized inputs: z0=torch.Size([256, 512]), action_seq=torch.Size([256, 3, 4])
[DEBUG] Tensor formats: z_roll=torch.Size([256, 3, 512]), all_mu=torch.Size([256, 3, 4])
[TIME] rollout:   11.92 ms
[TIME] compute Q:    7.74 ms
[TIME] reward loss:    3.52 ms
[TIME] value loss:    0.19 ms
[TIME] backward:   10.27 ms
[TIME] grad clipping:    0.77 ms
[TIME] optim.step:    1.05 ms
[TIME] _update total:   48.21 ms
----- Profiler Summary for _update method -----
Traceback (most recent call last):
  File "/home/levi/Documents/MOORE-TDMPC/moore_tdmpc/train_moore.py", line 165, in <module>
    train()
  File "/home/levi/Documents/MOORE-TDMPC/moore_tdmpc/utils/profiler.py", line 28, in wrapper
    result = func(*args, **kwargs)
  File "/home/levi/anaconda3/envs/tdmpc2/lib/python3.9/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/home/levi/anaconda3/envs/tdmpc2/lib/python3.9/site-packages/hydra/_internal/utils.py", line 394, in _run_hydra
    _run_app(
  File "/home/levi/anaconda3/envs/tdmpc2/lib/python3.9/site-packages/hydra/_internal/utils.py", line 457, in _run_app
    run_and_report(
  File "/home/levi/anaconda3/envs/tdmpc2/lib/python3.9/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
  File "/home/levi/anaconda3/envs/tdmpc2/lib/python3.9/site-packages/hydra/_internal/utils.py", line 458, in <lambda>
    lambda: hydra.run(
  File "/home/levi/anaconda3/envs/tdmpc2/lib/python3.9/site-packages/hydra/_internal/hydra.py", line 119, in run
    ret = run_job(
  File "/home/levi/anaconda3/envs/tdmpc2/lib/python3.9/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
  File "/home/levi/Documents/MOORE-TDMPC/moore_tdmpc/train_moore.py", line 145, in train
    trainer.train()
  File "/home/levi/Documents/MOORE-TDMPC/moore_tdmpc/utils/profiler.py", line 28, in wrapper
    result = func(*args, **kwargs)
  File "/home/levi/Documents/MOORE-TDMPC/TDMPC2/algorithms/trainer/online_trainer.py", line 126, in train
    _train_metrics = self.agent.update(self.buffer)
  File "/home/levi/Documents/MOORE-TDMPC/moore_tdmpc/train_moore.py", line 78, in _patched_update
    return self._update(obs, action, reward, task=task)
  File "/home/levi/Documents/MOORE-TDMPC/moore_tdmpc/utils/profiler.py", line 28, in wrapper
    result = func(*args, **kwargs)
  File "/home/levi/Documents/MOORE-TDMPC/moore_tdmpc/utils/timer.py", line 94, in wrapper
    result = f(*args, **kwargs)
  File "/home/levi/Documents/MOORE-TDMPC/moore_tdmpc/train_moore_agent.py", line 922, in _update
    print(prof.key_averages().table(sort_by="cuda_time_total", row_limit=10))
  File "/home/levi/anaconda3/envs/tdmpc2/lib/python3.9/site-packages/torch/profiler/profiler.py", line 313, in key_averages
    return self.profiler.key_averages(group_by_input_shape, group_by_stack_n)
  File "/home/levi/anaconda3/envs/tdmpc2/lib/python3.9/site-packages/torch/autograd/profiler.py", line 502, in key_averages
    return self._function_events.key_averages(
  File "/home/levi/anaconda3/envs/tdmpc2/lib/python3.9/site-packages/torch/autograd/profiler_util.py", line 332, in key_averages
    stats[get_key(evt, group_by_input_shapes, group_by_stack_n)].add(evt)
  File "/home/levi/anaconda3/envs/tdmpc2/lib/python3.9/site-packages/torch/autograd/profiler_util.py", line 697, in add
    self.self_cpu_time_total += other.self_cpu_time_total
  File "/home/levi/anaconda3/envs/tdmpc2/lib/python3.9/site-packages/torch/autograd/profiler_util.py", line 570, in self_cpu_time_total
    if self.is_async or self.device_type != DeviceType.CPU:
KeyboardInterrupt